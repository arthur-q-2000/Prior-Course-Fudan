# 10 函数

负责人：[@arthur-q-2000](https://github.com/arthur-q-2000)

课程视频：
/Users/apple/Desktop/OneDrive/#Documents/#19- Undergraduate/Activities/2020.08 先导课程设计/最终/第十章 函数/【教学视频】第十章 函数.mp4

课件PPT：
/Users/apple/Desktop/OneDrive/#Documents/#19- Undergraduate/Activities/2020.08 先导课程设计/最终/第十章 函数/【PDF无讲稿】第十章 函数.pdf

讲稿内容：

各位同学大家好，欢迎继续学习程序设计的先导课程。随着我们对于课程的学 习，我们已经基本学习了c语言的基本内容。接下来，如何更加高效的组合这些 基础知识，让我们的代码更加简洁、高效，是我们今天的学习重点。本次课 程，我们来讲讲程序设计的最后一章：函数。

首先先简单看看本节课我们要讲到的知识点，主要分为四个部分：函数的定 义、函数的调用、函数的局部变量与全局变量，以及最后的一道典型例题“二 分法解方程”。

让我们抛开函数，先看看我们在写代码的时候容易出现的情况：如果 要写三个程序，每个程序中有相似的部分，我们是否需要在主程序中不断的复 制粘贴来移植代码呢？或者是程序要求多、细节多、代码极其复杂，结果编译 的时候⽼是失败，程序极其复杂使得⾃⼰找了好久也找不到bug在哪⾥？亦或者 是在同⼀个程序中不断出现相似的功能，不停的复制粘贴只能增加⽆效代码的 ⻓度，降低可读性？由于以上的情况常常出现在⽣活中，函数也就应运⽽⽣ 了。如果出现了以上的任意⼀种情况，我们都可以使⽤函数来解决。

函数有什么特点？第一，它有很强的可移植性。在不同程序之间，使用函数的 话可以避免代码不断的复制粘贴，减小出错的可能，增加了同一个大程序下不 同的子程序的协同与效率。第二，函数的调试更加方便，更容易分析程序的结 构和bug存在的位置。第三，函数的存在可以降低程序的复杂性，比如“选择两 个数中更大的数”，写成代码需要在主函数中占据好几行，而使用函数的话则 可以使用简单的一句指令，增加程序的可读性。第四，函数可以有效避免重复 的代码段，给自己节约打代码的时间和精力。

刚开始，让我们先来讲一讲函数的定义。函数的定义离不开三要素：函数名、函数返 回值类型、函数参数的名字和类型。定义函数的模板如ppt中所示，首先打好返 回值类型名，例如int、float、double等等，作为这个函数运行结束后返回的值 的类型；然后是函数名，名字可以自己取，与命名方式的限制相同；括号里是 形式参数的类型和名字，命名方式和变量相同。举例说明，如果要写一个求两 数中的大数的函数，首先确定这两个数都是整型，因此求出的返回值的类型也 是整型，所以最前写int；其次确定函数的名字，既然是求大数，我们就写max； 然后是参数的类型和名字，前面已经说过都为整型，所以也是int。在函数体内， 我们只需要正常编写“求大数”的代码即可，最后return返回的类型需要与函数 返回值的类型一致。

接下来我们来讲讲函数的调用。函数的调用方式主要分为三个部分：函数调用 语句、函数表达式调用以及函数返回值作为参数。第一种调用方式是函数调用语句。我们不需要函数的返回值，只需要执行一定的功能，完成一定操作即可。比如此处的我希望输出一个五角星，我编写好函数以后，在主程序中只需要写printf_star()即可完成需求。第二种调用方式是函数表达式调用。函数有自己的返回值，而这个返回值本身在表达式中也是可以作为一个值存在的。比如求两个数之间的大数，a、b的值确定以后，max（a，b）的值也是确定的，就是a、b中更大的数的值。ppt中的赋值表达式中，就是将max（a，b）的值赋给了c。第三种调用方式是函数返回值作为参数。比如ppt中的max（a，b），本质上是printf的一个参数，实际上是将max（a，b）的返 回值作为了一个参数使用。

讲完调用的方式，我们再来讲讲函数调用的过程。当我们在主程序中调用函数 的时候，具体的调用过程是怎么样的呢？以本段代码中加粗的c=max（a，b） 为例：首先，系统会将实参a和b的值传递给函数中的形参x和y；然后，函数max 的函数体内的代码将会开始执行；其次，当函数执行到return时，返回的z的值 以int的类型传递了出来；最后，这个z的值被赋值给了c。

现在请同学们暂停一下视频，看看左边这段代码。我们可以看到，z这个变量在 函数中和主程序中被定义了两次。既然如此，不同的z的值是会有所不同呢，还 是一直相同呢？如果相同的话，在什么范围内是相同的呢？这些问题就会引出 我们的下一个重点：局部变量与全局变量。局部变量与全局变量是函数中非常重要的知识点，这决定了变量的适用范围。一旦弄错了适用范围，则会导致整个函数出现混乱，给调试带来很大的麻烦。

局部变量是在函数内部定义的变量，仅在本函数范围内有效，函 数以外不得引⽤。该变量的值仅仅在该函数内部才能起作⽤。局部变量有⼏点 特性需要说明。第⼀，在不同函数中可以使⽤同名的变量。它们代表不同对 象，互不⼲扰。也就是说，函数内部的局部变量优先级最⾼，⼀旦在局部定义 了该变量，所有的函数体的代码都只针对该函数内的局部变量起作⽤。⼀旦脱 离该函数体，这个变量的值就不起作⽤了。途中有⼀段代码，⼤家可以暂停视 频，分析⼀下会输出什么。

最终输出的是0_10_-8_。第⼀次输出之前执⾏了max（a，b）， 但是其中的z变量是局部变量，在主函数中没有作⽤，所以z的值由主函数定义 变量时z=0决定；第⼆次输出之前把max（a，b）的值赋给了z，要注意，该赋 值表达式等式左侧的z并不是max函数中的局部变量z，⽽是主函数中的变量z。 这个z原来的值是0，⽽max（a，b）返回的值是10，z的值也就被赋值为了10； 第三次与第⼆次相同，主函数中的z的值被赋值为了-8。但是要记住，max函数 和min函数中的z的值，在脱离函数之后便消失了、没有意义了，留下的只有函 数的返回值⽽已。

第二个特性是：形式参数也是局部变量，其它函数可以调⽤该函数，但不能直 接引⽤该函数的形参。也就是说，途中黄色下划线的形式参数也是其他函数中 不可引用的。一旦离开这个函数，形式参数的值也会无意义。第三个特性是， 如果在函数内部的大括号内定义变量，这个变量可以作为一个更加局部的变量 存在，只在这段大括号中有效。

讲完了局部变量，再来讲讲全局变量。全局变量是在函数之外定义的变量，可 以为本⽂件中其它函数所共⽤。有效范围为从定义变量的位置开始到本源⽂件 结束。其中要注意，如果在⼀个函数中改变了全局变量的值，就能影响到其它 函数中全局变量的值。这句话的前提是该变量在函数中没有被局部定义过，因 为根据刚才我们分析局部变量的特点，⼀旦函数体中定义了局部变量，优先级 就⾼于全局变量，导致全局变量的值在该函数体中不受到影响。⼤家可以暂停 视频，做⼀做这道题。（留出空闲时间）这道题中要注意的是z变量被赋值为20 是在函数体外，因此主函数中，第⼀次执⾏max（a，b）后，z的值就变成了10. 后续的答案与上⼀题是相同的，都是10和-8.

第二个要注意的是，在同⼀个源⽂件中，全局变量与局部变量同名时，在局部 变量的作⽤范围内，局部变量有效，全局变量不起作⽤。大家可以暂停视频做 一下下面这道题。（暂停）这里与上一题的唯一区别是，在主函数中多定义了 一个z=0。而这个定义直接导致了全局变量z的值在主函数中失效，z的值在主函 数中成为了主函数的“局部变量”，值为0。因此输出的值为0_10_-8_。

最后，让我们分析一道完整的例题，编写一道程序：利用二分法解一个方程。 解题思路是这样的：对于⽅程 f(x)=0, 若f(a)*f(b)<0,则区间[a,b]内⼀定包含着⽅程 式的根.因此,可根据以下步骤进⾏: (1)先要找出⼀个区间[a,b],使得f(a)与f(b)异号。根据零点存在定理,这个区间内⼀ 定包含着⽅程式的根;
(2)求该区间的中点 m=(a+b)/2,并找出f(m)的值;
(3)若f(m)与f(a)符号相同,则取[m,b]为新的区间,否则取[a,m]为新的区间;
(4)重复(2)和(3),直到得到理想的精确度为⽌.

明白了解题思路之后，我们就可以进行实战了：求x3−x−1=0的根。当然，由于 我们是程序设计课，明白解题思路其实不是重点，重点是如何把解题思路转化 为程序设计的语言和代码。大家可以暂时暂停视频，按照ppt上的要求，思考一 下代码如何落实。其中需要注意的有以下几点：
首先，f(x)=x*x*x-x-1这个函数是需要定义的；
其次，第一步需要先判断输入的a 和b是否可以使用二分法；
还有，a和b可能出现小数，变量类型至少为double，不能简单的定义为整型。请大家暂停视频，思考一下代码和框架。

大家的脑海里现在已经有了初步的代码框架，下面让我们来分析一下完整的代 码。需要注意，由于二分法本身的特点和类型double的限制，我们无法找出确 切的根的值，只能通过f（x）约等于0的x的近似情况来推断。首先我们先看函数 部分。在程序一开始，我们要先使用宏定义来定义精度eps，当然，不使用宏定 义也可以实现。然后要定义f（x）这个函数。

接下来是整个二分法的核心程序。 由于我们需要不断的重复替换a和b，因此必须需要一个循环，这里使用了while 的循环，并且将退出循环的条件放在了循环中。刚刚我们提到，需要在二分法 使用之前考虑a和b的值是否能够使用二分法，我们将这一步放到主程序中，以 免破坏函数的结构。然后是对a和b取平均值得出m的值，并判断f（m）的值是 否已经接近0了。如果接近0，精度达到要求，跳出循环；如果小于0.则说明 [a,m]区间中必然存在至少一个f（x）=0的根。因此，我们将m的值赋值给b，将 范围缩小了一半，b变成了b’，m’变成了(a+b’)/2，循环继续。同理，如果 f(a)*f(m)>0，就把m的值赋给a缩小范围。最终一定会退出循环，这时候的m就 可以看成是方程的根。这样，二分法的核心程序就完成了。

接下来我们来看主函数。
使用函数来写二分法核心程序以后，主函数看起来就十分清爽、结构清晰了。首先是简单的输入a、b的值，这时候我们需要写一个循环，其中包含了二分法使用条件的判断。如果不满足条件，循环继续，重新输入a和b的值；如果满足条件，就退出循环并执行二分法解方程的函数。判断二分法是否可用，需要判断f(a)*f(b)的值是否大于0。如果等于0，该函数的一个根就是a或者b，但是也无法使用二分法来解该方程；如果大于0，也无法使用。最后，直接将binaryRoot作为printf的一个参数即可，因为这个函数的返回值就是f（x）的一个根。至此，这个程序就完成了。 

在这道题中，我们也可以看到函数的优越性。如果我们需要求另一个方程的根， 我们只需要在开始定义f（x）的时候更改里面的一句代码，剩下的全文都不需 要有任何的更改，非常便捷。主程序也结构十分清晰明了，易于调试。

最后给大家留一个课后作业：请大家自己在电脑上实现并运行二分法解方程， 实打实的自我操作可以更好的发现自己的问题和不足之处。本节课的内容就到 这里了，这也是程序设计先导手册的最后一节内容，十分感谢各位的观看，祝 各位学习愉快。


## FAQ

